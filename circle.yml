machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
    - /home/ubuntu/aws

  pre:
    - if [ -z "$BUCKET_NAME" ]; then echo Bucket name must be specified as an environment variable; exit 1; fi
    - if [[ ! -d $HOME/aws ]]; then curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip" && unzip awscli-bundle.zip && sudo ./awscli-bundle/install -i $HOME/aws; fi
    - ./build_container.sh

test:
  override:
     - echo "test"

deployment:
  develop:
    branch: master
    owner: grafana
    commands:
      # - ./deploy.sh
      - mkdir dist
      - echo test > dist/test.txt
      - $awscli s3 sync ./dist s3://$BUCKET_NAME
